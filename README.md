# jq-sh
A shell script wrapper for [jq](https://stedolan.github.io/jq) (the command-line JSON processor)

## Getting Started
### Installation:
```
git clone git@github.com:jq-sh/jq-sh.git ~/Code/jq-sh/jq-sh
export PATH="$HOME/Code/jq-sh/jq-sh/bin:$PATH"
```


#### Requirements:
 * [jq](https://stedolan.github.io/jq)
 * [bash](https://www.gnu.org/software/bash/)


## Motivation

[jq](https://stedolan.github.io/jq) (the command-line JSON processor) is lightweight and flexible with zero runtime dependencies, but can be a little painful to use in simple shell scripts.

Consider that you might start with a shell script like this:

#### [a.sh](https://github.com/jq-sh/jq-sh/blob/main/shpecs/support/a.sh)
```bash
#!/usr/bin/env bash

# TODO allow this script to handle a variable number of value args using `$@` ... ?somehow?
echo "{ \"$key\": [\"$1\", \"$2\", \"$3\"] }"
```

‚ùØ `key=fruit ./shpecs/support/a.sh apple banana cherry`
```json
{ "fruit": ["apple", "banana", "cherry"] }
```

‚ùØ `key=animals ./shpecs/support/a.sh ant bee cat`
```json
{ "animals": ["ant", "bee", "cat"] }
```

And then realize `jq` would make generating your JSON a _lot_ easier with something like:

#### [a.jq](https://github.com/jq-sh/jq-sh/blob/main/shpecs/support/a.jq)
```jq
{
  ($key): $values
}

```

‚ùØ `jq --null-input --arg key animals --argjson values '["ant", "bee", "cat"]' --from-file ./shpecs/support/a.jq`
```json
{
  "animals": [
    "ant",
    "bee",
    "cat"
  ]
}
```
_Ahh... nice `jq` even pretty printed it for free! :)_


ü§î... but what if we could smash those two scripts together?
 * gaining the JSON processing power of `jq`
 * without losing the simplicity of getting env vars & command line arguments into our a shell script

So `jq-sh` (written in bash) provides a [DSL](https://en.wikipedia.org/wiki/Domain-specific_language) to invoke our `jq` script with all the env vars and command line args we want to send to it.

And it can be used like this:

#### [a.jqsh](https://github.com/jq-sh/jq-sh/blob/main/shpecs/support/a.jqsh)
```bash
#!/usr/bin/env jq-sh

# First the bash part...
# Write whatever bash you need here...
# ... but just make sure you don't write *anything* to stdout
# (Nb. using '>&2' allows bash to send output to stderr & avoid messing with jq-sh)


# Then use jq-sh's bash DSL to tell jq-sh how to invoke `jq` for you.
# Noting that we still have access to any ENV vars & command line args `$@`
# because we're still in `bash` land here...
opts --null-input --raw-input --raw-output
arg        key    $key
arg_array  values $@


# Then this bash script ends at the special `__JQ__` marker.
# And everything after it is sent to `jq` as a file for it to run.
# ie. with the command line arguments generated by our DSL calls above.


__JQ__


# NB. *Now* we're in a jq script, so make sure to _only_ write `jq` from now on...

{
  ($key): $values
}
```


‚ùØ `key=animals ./shpecs/support/a.jqsh ant bee cat`
```json
{
  "animals": [
    "ant",
    "bee",
    "cat"
  ]
}
```



### Example Usages:
 * [json-redact](https://github.com/jq-sh/jq-sh/blob/main/bin/json-redact)
   * This example script written in `jq-sh` takes `redacted_keys` as arguments as
     well as a `$MAX_LENGTH` env var to redact the values of any of the keys it finds
     in the JSON it is applied to.
   * see [shpecs/json-redact_shpec.sh](https://github.com/jq-sh/jq-sh/blob/main/shpecs/json-redact_shpec.sh)
     * _(Use `shpecs/json-redact_shpec.sh` to run that shpec)_
     * _(or `shpec`, or `make test` to run the whole suite)_



## Also included
### [json2table](https://github.com/jq-sh/jq-sh/blob/main/screencasts/json2table.md)


#### Requirements:
 * [jq](https://stedolan.github.io/jq)
 * [jq-sh](https://github.com/jq-sh/jq-sh)


#### Example Usages:

## color
[![asciicast](https://asciinema.org/a/0rxyVXCr0CnGiEW99mz7a3Osr.svg)](https://asciinema.org/a/0rxyVXCr0CnGiEW99mz7a3Osr)
## json2table
[![asciicast](https://asciinema.org/a/tDodJIElJMPuPEMMbVM6x1JxD.svg)](https://asciinema.org/a/tDodJIElJMPuPEMMbVM6x1JxD)
## jsonl2tsv
[![asciicast](https://asciinema.org/a/RqGkWuk0nUz31CKatuR4lXv0L.svg)](https://asciinema.org/a/RqGkWuk0nUz31CKatuR4lXv0L)
## tsv2table
[![asciicast](https://asciinema.org/a/qx2AreNMBnztFlAUZaSQPu35L.svg)](https://asciinema.org/a/qx2AreNMBnztFlAUZaSQPu35L)
